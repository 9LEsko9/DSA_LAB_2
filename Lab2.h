#pragma once

#include <stdio.h>
#include <string.h>
#include <ctype.h>
#include <stdlib.h>

//  Задача 1:

//	Дана строка символов. Необходимо ввести ее, используя функцию malloc, free.
//	Программа должна работать след. образом: для ввода 1-ого символа захватываем
//	память с помощью функции malloc. Если строка не закончена, то захватываем память
//	под два символа с помощью функции malloc, в нее самостоятельно переписываем
//	введенные символы и добавляем один новый. Память, захваченную ранее,
//	освобождаем с помощью функции free. И так делаем до тех пор, пока не введем всю
//	строку. При этом каждый раз увеличиваем размер захватываемой памяти на один
//	символ. Далее строка обрабатывается в соответствии с задачей.

//	================================================================================

// Задача 2:

//	Дана строка символов. Необходимо ввести ее, используя функцию calloc, realloc,
//	free. Программа должна работать след. образом: для ввода нескольких символов (не
//	более 5) захватываем память с помощью функции сalloc. Если строка не закончена,
//	то изменяем размер памяти с помощью функции realloc. При этом каждый раз
//	захватываем память больше на выбранную нами добавляемую порцию (не более 5).
//	И так делаем до тех пор, пока не введем всю строку. Далее строка обрабатывается в
//	соответствии с задачей.

//	================================================================================

// Задача 3:

// Строку вводим по 1-му или 2-му варианту, записываем ее в файл. Далее читаем 
// строку из файла, выделяя память под нее как в 1-ом или 2-ом варианте, обрабатываем
// ее, результат помещаем в файл.

#define STR_START_CAPACITY_ 5
#define STR_CAPACITY_STEP_ 5

#define TEMP_FILE_NAME_ "temp.txt"

typedef enum {
	MALLOC,
	REALLOC,
} ReaderType;

typedef enum {
	MAIN_BUFFER_ALLOC_FAILED = -10,
	TEMP_BUFFER_ALLOC_FAILED,
	BUFFER_REALLOC_FAILED,

	GETTING_STRING_FAILED,
	FILE_OPEN_FAILED,
	FILE_READ_FAILURE,
	FILE_WRITE_FAILURE,
	STRING_PROCESSING_FAILED,
	EMPTY_IO_STREAM,

	NONE = 0,
} ErrorType;

typedef struct {
	size_t len;
	size_t capacity;
	char* buffer;
} string_;


// Обрабатывает строку: четные цифры в слова, нечетные в коды
// Возвращает новую строку, нужно освободить через free

char* get_processed_string(char* buffer);

// TASK 1

// Читает строку по символу, каждый раз выделяя новый буфер

char* read_string_dynamic_malloc(FILE* istream);

// TASK 2

// Читает строку порциями по 5 символов, расширяя буфер через realloc

char* read_string_dynamic_realloc(FILE* istream);

// TASK 3

// Читает строку из stdin, записывает во временный файл, 
// читает обратно, обрабатывает и сохраняет результат

int read_and_process_string_to_file(ReaderType type, char* out_filepath);